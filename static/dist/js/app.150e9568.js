(function(t){function e(e){for(var s,l,n=e[0],i=e[1],c=e[2],u=0,v=[];u<n.length;u++)l=n[u],Object.prototype.hasOwnProperty.call(a,l)&&a[l]&&v.push(a[l][0]),a[l]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);d&&d(e);while(v.length)v.shift()();return r.push.apply(r,c||[]),o()}function o(){for(var t,e=0;e<r.length;e++){for(var o=r[e],s=!0,l=1;l<o.length;l++){var i=o[l];0!==a[i]&&(s=!1)}s&&(r.splice(e--,1),t=n(n.s=o[0]))}return t}var s={},a={app:0},r=[];function l(t){return n.p+"js/"+({about:"about"}[t]||t)+"."+{about:"d83cb903"}[t]+".js"}function n(e){if(s[e])return s[e].exports;var o=s[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.e=function(t){var e=[],o=a[t];if(0!==o)if(o)e.push(o[2]);else{var s=new Promise((function(e,s){o=a[t]=[e,s]}));e.push(o[2]=s);var r,i=document.createElement("script");i.charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.src=l(t);var c=new Error;r=function(e){i.onerror=i.onload=null,clearTimeout(u);var o=a[t];if(0!==o){if(o){var s=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",c.name="ChunkLoadError",c.type=s,c.request=r,o[1](c)}a[t]=void 0}};var u=setTimeout((function(){r({type:"timeout",target:i})}),12e4);i.onerror=i.onload=r,document.head.appendChild(i)}return Promise.all(e)},n.m=t,n.c=s,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var d=c;r.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"034f":function(t,e,o){"use strict";var s=o("85ec"),a=o.n(s);a.a},"56d7":function(t,e,o){"use strict";o.r(e);o("e260"),o("e6cf"),o("cca6"),o("a79d");var s=o("2b0e"),a=o("5c96"),r=o.n(a),l=(o("0fae"),function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("router-view")],1)}),n=[],i=(o("034f"),o("2877")),c={},u=Object(i["a"])(c,l,n,!1,null,null,null),d=u.exports,v=(o("d3b7"),o("8c4f")),f=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"home"},[t.show?o("div",{staticClass:"content"},[o("h2",[t._v("新建表决")]),o("el-form",{ref:"voteForm",attrs:{size:"small",model:t.vote}},[o("el-form-item",{attrs:{prop:"title",rules:[{required:!0,message:"请输入标题",trigger:"blur"}]}},[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("标题：")]),o("el-input",{model:{value:t.vote.title,callback:function(e){t.$set(t.vote,"title",e)},expression:"vote.title"}})],1),t._l(t.vote.discussionList,(function(e,s){return o("div",{key:s},[o("el-form-item",{attrs:{prop:"discussionList."+s+".content",rules:[{required:!0,message:"请输入内容",trigger:"blur"}]}},[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("内容：")]),o("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:e.content,callback:function(o){t.$set(e,"content",o)},expression:"dis.content"}})],1),t._l(e.options,(function(e,a){return o("el-row",{key:a,attrs:{type:"flex"}},[o("el-col",{attrs:{span:16}},[o("el-form-item",{attrs:{prop:"discussionList."+s+".options."+a+".text",rules:[{required:!0,message:"请输入选项内容",trigger:"blur"}]}},[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("选项"+t._s(a+1)+"：")]),o("el-input",{attrs:{placeholder:"输入选项内容"},model:{value:e.text,callback:function(o){t.$set(e,"text",o)},expression:"opt.text"}})],1)],1),o("el-col",{attrs:{span:8}},[o("el-button",{staticClass:"remOpt",attrs:{type:"primary"},on:{click:function(e){return t.remOpt(s,a)}}},[t._v("删除选项")])],1)],1)})),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:24}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("可选选项数")]),o("el-input-number",{attrs:{min:1,max:e.options.length-1},model:{value:e.settingObj.num,callback:function(o){t.$set(e.settingObj,"num",o)},expression:"dis.settingObj.num"}})],1)],1)],1),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:12}},[o("el-button",{staticClass:"remOpt",attrs:{type:"primary"},on:{click:function(e){return t.addOpt(s)}}},[t._v("新增选项")])],1),o("el-col",{attrs:{span:12}},[o("el-button",{staticClass:"remOpt",attrs:{type:"primary"},on:{click:function(e){return t.remDis(s)}}},[t._v("删除议题")])],1)],1)],2)})),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:24}},[o("el-button",{staticClass:"remOpt",attrs:{type:"primary"},on:{click:function(e){return t.addDis()}}},[t._v("新增议题")])],1)],1),o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("表决设置")])]),o("hr"),o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("监票人员数：")]),o("el-input-number",{attrs:{min:0},model:{value:t.vote.settingObj.setForMonitor.num,callback:function(e){t.$set(t.vote.settingObj.setForMonitor,"num",e)},expression:"vote.settingObj.setForMonitor.num"}})],1),o("hr"),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:4}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("口径设置：")])])],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("按股数统计")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForVoters.kind.weight,callback:function(e){t.$set(t.vote.settingObj.setForVoters.kind,"weight",e)},expression:"vote.settingObj.setForVoters.kind.weight"}})],1)],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("按票数统计")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForVoters.kind.votes,callback:function(e){t.$set(t.vote.settingObj.setForVoters.kind,"votes",e)},expression:"vote.settingObj.setForVoters.kind.votes"}})],1)],1)],1),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:4}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("方式设置：")])])],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("占已投比例")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForVoters.way.already,callback:function(e){t.$set(t.vote.settingObj.setForVoters.way,"already",e)},expression:"vote.settingObj.setForVoters.way.already"}})],1)],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("占应投比例")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForVoters.way.should,callback:function(e){t.$set(t.vote.settingObj.setForVoters.way,"should",e)},expression:"vote.settingObj.setForVoters.way.should"}})],1)],1)],1),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:4}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("查看设置：")])])],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("过程中查看")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForVoters.view.inProcess,callback:function(e){t.$set(t.vote.settingObj.setForVoters.view,"inProcess",e)},expression:"vote.settingObj.setForVoters.view.inProcess"}})],1)],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("结束后查看")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForVoters.view.afterProcess,callback:function(e){t.$set(t.vote.settingObj.setForVoters.view,"afterProcess",e)},expression:"vote.settingObj.setForVoters.view.afterProcess"}})],1)],1)],1),o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("表决设置（针对监票员）")])]),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:4}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("口径设置：")])])],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("按股数统计")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForMonitor.kind.weight,callback:function(e){t.$set(t.vote.settingObj.setForMonitor.kind,"weight",e)},expression:"vote.settingObj.setForMonitor.kind.weight"}})],1)],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("按票数统计")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForMonitor.kind.votes,callback:function(e){t.$set(t.vote.settingObj.setForMonitor.kind,"votes",e)},expression:"vote.settingObj.setForMonitor.kind.votes"}})],1)],1)],1),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:4}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("方式设置：")])])],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("占已投比例")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForMonitor.way.already,callback:function(e){t.$set(t.vote.settingObj.setForMonitor.way,"already",e)},expression:"vote.settingObj.setForMonitor.way.already"}})],1)],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("占应投比例")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForMonitor.way.should,callback:function(e){t.$set(t.vote.settingObj.setForMonitor.way,"should",e)},expression:"vote.settingObj.setForMonitor.way.should"}})],1)],1)],1),o("el-row",{attrs:{type:"flex"}},[o("el-col",{attrs:{span:4}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("查看设置：")])])],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("过程中查看")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForMonitor.view.inProcess,callback:function(e){t.$set(t.vote.settingObj.setForMonitor.view,"inProcess",e)},expression:"vote.settingObj.setForMonitor.view.inProcess"}})],1)],1),o("el-col",{attrs:{span:10}},[o("el-form-item",[o("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[t._v("结束后查看")]),o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#CCC"},model:{value:t.vote.settingObj.setForMonitor.view.afterProcess,callback:function(e){t.$set(t.vote.settingObj.setForMonitor.view,"afterProcess",e)},expression:"vote.settingObj.setForMonitor.view.afterProcess"}})],1)],1)],1),o("el-row",[o("el-col",{attrs:{span:24}},[o("el-button",{attrs:{type:"primary"},on:{click:t.chooseVoters}},[t._v("选择发布范围(已选参与人数"+t._s(t.vote.parUser.length)+")")])],1)],1),o("el-row",[o("el-col",{attrs:{span:12}},[t.submitDisabled?o("el-button",{attrs:{type:"primary",disabled:""}},[t._v("保存议题")]):o("el-button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:function(e){return t.voteSubmit("voteForm")}}},[t._v("保存议题")])],1),o("el-col",{attrs:{span:12}},[o("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("暂存议题")])],1)],1)],2)],1):o("div",[t._v(" 你不是管理员，无法操作！！！ ")]),o("el-drawer",{attrs:{title:"选择参与人员",visible:t.drawer,direction:"ltr",size:"50%"},on:{"update:visible":function(e){t.drawer=e}}},[o("div",{staticClass:"treeBox"},[o("el-tree",{attrs:{load:t.loadNode,props:t.props,lazy:"","show-checkbox":""},on:{check:t.handleCheck}}),o("el-button",{attrs:{type:"primary"},on:{click:t.setVoter}},[t._v("确定")]),o("div",[o("h3",[t._v("已选人员列表：")]),o("p",t._l(t.vote.parUser,(function(e,s){return o("span",{key:s},[t._v(t._s(e.name))])})),0)])],1)])],1)},p=[],b=(o("a4d3"),o("e01a"),o("d28b"),o("99af"),o("4de4"),o("a434"),o("3ca3"),o("159b"),o("ddb0"),o("9c55")),m=o("4328"),h=o.n(m),g=o("bc3a"),w=o.n(g),y={corpId:"ding989f59cf138502f135c2f4657eb6378f",domain:"http://localhost:8080",status:{ok:0}},C={config:function(){return y},confirm:function(t,e,o,s){return new Promise((function(a,r){b["ready"]((function(){b["device"].notification.confirm({message:t,title:e,buttonLabels:[o,s],onSuccess:function(t){0==t.buttonIndex?a(t):r(t)},onFail:function(t){r(t)}})}))}))},login:function(){return new Promise((function(t,e){b["ready"]((function(){b["runtime"].permission.requestAuthCode({corpId:y.corpId,onSuccess:function(e){var o=e.code;w()({method:"post",url:y.domain+"/login",data:h.a.stringify({authCode:o}),withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(e){t(e.data)}))},onFail:function(t){e(t)}})}))}))},getDept:function(t){return new Promise((function(e,o){w()({method:"post",data:h.a.stringify({pId:t}),url:y.domain+"/getDept",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(t){e(t.data)})).catch((function(t){o(t)}))}))},getDeptUser:function(t){return new Promise((function(e,o){w()({method:"post",data:h.a.stringify({dId:t}),url:y.domain+"/getDeptUser",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(t){e(t.data)})).catch((function(t){o(t)}))}))}},O={name:"home",data:function(){return{show:!0,drawer:!1,submitLoading:!1,submitDisabled:!1,props:{label:"name",isLeaf:"leaf"},checkedUser:[],vote:{title:"",copies:0,parUser:[],totalWeight:0,alreadyWeight:0,operPerId:"",operPerName:"",monitorList:[],settingObj:{setForVoters:{kind:{weight:!0,votes:!0},way:{already:!0,should:!0},view:{inProcess:!0,afterProcess:!0}},setForMonitor:{num:3,kind:{weight:!0,votes:!0},way:{already:!0,should:!0},view:{inProcess:!0,afterProcess:!0}}},state:"4",state2:"0",votedUserIdList:[],discussionList:[{type:1,content:"",settingObj:{num:1},options:[{text:"",votes:0,userIds:[]},{text:"",votes:0,userIds:[]}]},{type:1,content:"",settingObj:{num:1},options:[{text:"",votes:0,userIds:[]},{text:"",votes:0,userIds:[]}]}]}}},created:function(){var t=this,e=this.$loading({lock:!0,text:"自动登录中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});C.login().then((function(o){if(e.close(),o.status.code==C.config().status.ok){if(1!=o.data.managerflag)return void(t.show=!1);t.vote.operPerName=o.data.userName,t.vote.operPerId=o.data.userId;var s=JSON.parse(window.localStorage.getItem("vote"));s&&t.$confirm("检测到暂存的表决，是否继续编辑?","打开暂存表决",{confirmButtonText:"确定",cancelButtonText:"取消",type:"primary"}).then((function(){t.vote=s}))}else t.$message(o.status.msg)}))},methods:{addOpt:function(t){var e={text:"新增选项",votes:0,userIds:[]};this.vote.discussionList[t].options.push(e)},remOpt:function(t,e){this.vote.discussionList[t].options.splice(e,1)},addDis:function(){var t={type:1,content:"新增表决议案",settingObj:{num:1},options:[{text:"默认选项1",votes:0,userIds:[]},{text:"默认选项2",votes:0,userIds:[]}]};this.vote.discussionList.push(t)},remDis:function(t){var e=this;C.confirm("不可逆操作！是否删除议题？","不可逆操作","确认","取消").then((function(){e.vote.discussionList.splice(t,1)}))},chooseVoters:function(){this.drawer=!this.drawer},loadNode:function(t,e){var o=this,s=void 0,a=void 0;t.level>0&&(s=t.data.id),C.getDept(s).then((function(t){t.status.code==C.config().status.ok?(a=t.data,C.getDeptUser(s).then((function(s){s.status.code==C.config().status.ok?(s.data.forEach((function(t){t.leaf=!0,t.userId=t.userid,delete t.userid})),a=a.concat(s.data),e(a)):o.$message(t.status.msg)})).catch((function(t){o.$message.error("服务器异常，请重试！")}))):o.$message(t.status.msg)})).catch((function(t){o.$message.error("服务器异常，请重试！")}))},handleCheck:function(t,e){this.checkedUser=e.checkedNodes.filter((function(t){return t.leaf}));var o=[],s={},a=!0,r=!1,l=void 0;try{for(var n,i=this.checkedUser[Symbol.iterator]();!(a=(n=i.next()).done);a=!0){var c=n.value;s[c.userid]||(o.push(c),s[c.userid]=1)}}catch(u){r=!0,l=u}finally{try{a||null==i.return||i.return()}finally{if(r)throw l}}this.checkedUser=o},setVoter:function(){this.vote.parUser=this.checkedUser,this.vote.copies=this.checkedUser.length},save:function(){window.localStorage.setItem("vote",JSON.stringify(this.vote)),this.$message({message:"暂存成功",type:"success"})},voteSubmit:function(t){var e=this,o=this.vote.parUser.length;o?(this.submitLoading=!0,this.$refs[t].validate((function(t){if(!t)return!1;e.submitDisabled=!0;var o=JSON.stringify({vote:e.vote});w()({method:"post",data:h.a.stringify({param:o}),url:C.config().domain+"/buildNewVote",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(t){e.submitLoading=!1;var o=t.data;console.log(C),o.code==C.config().status.ok?e.$alert("保存成功，请在钉钉手机APP进行查看和发布！","提示",{confirmButtonText:"确定",callback:function(t){window.location.reload()}}):e.$message({message:o.msg,type:"error"})})).catch((function(t){window.console.log(JSON.stringify(t))}))}))):this.$alert("请先选择发布范围！","提示",{confirmButtonText:"确定",callback:function(t){}})}}},k=O,x=(o("6ab6"),Object(i["a"])(k,f,p,!1,null,"69be22fe",null)),j=x.exports;s["default"].use(v["a"]);var _=[{path:"/",name:"addNewVote",component:j},{path:"/about",name:"about",component:function(){return o.e("about").then(o.bind(null,"f820"))}}],F=new v["a"]({routes:_}),P=F,$=o("2f62");s["default"].use($["a"]);var M=new $["a"].Store({state:{},mutations:{},actions:{},modules:{}});s["default"].use(r.a),s["default"].config.productionTip=!1,new s["default"]({router:P,store:M,render:function(t){return t(d)}}).$mount("#app")},"6ab6":function(t,e,o){"use strict";var s=o("e5a7"),a=o.n(s);a.a},"85ec":function(t,e,o){},e5a7:function(t,e,o){}});
//# sourceMappingURL=app.150e9568.js.map